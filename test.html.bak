<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Viewport Layouts</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			html,
			body {
				height: 100vh;
				overflow: hidden;
			}

			body {
				font-family: system-ui, -apple-system, sans-serif;
				background: black;
				border: 3px solid blue;
			}

			#container {
				height: 100vh;
				display: grid;
				background: black;
			}

			.section {
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 2rem;
				color: white;
				background: black;
			}

			/* Layout grids */
			.single {
				grid-template: 1fr / 1fr;
			}
			.halves {
				grid-template: 1fr / 1fr 1fr;
			}
			.halves.vertical {
				grid-template: 1fr 1fr / 1fr;
			}
			.split {
				grid-template: 1fr 1fr / 1fr 1fr;
			}

			/* Hidden sections */
			.single #s2,
			.single #s3,
			.halves #s3 {
				display: none;
			}

			/* Borders */
			.halves #s1,
			.split #s1 {
				border-right: 3px solid blue;
			}
			.halves.vertical #s1,
			.split #s2,
			.split.vertical #s1 {
				border-bottom: 3px solid blue;
			}

			/* Grid positioning */
			.split #s1 {
				grid-row: 1 / 3;
			}
			.split.vertical #s1 {
				grid-row: 1;
				grid-column: 1 / 3;
			}

			/* Vertical layout adjustments */
			.halves.vertical #s1,
			.split.vertical #s1 {
				border-right: none;
			}
			.split.vertical #s2 {
				border-bottom: none;
				border-right: 3px solid blue;
			}
		</style>
	</head>
	<body>
		<div id="container" class="single">
			<div id="s1" class="section"></div>
			<div id="s2" class="section"></div>
			<div id="s3" class="section"></div>
		</div>

		<script>
			const container = document.getElementById('container');
			const sections = Array.from(container.children);
			const states = ['State 1', 'State 2', 'State 3'];
			let focusedIndex = 0;

			const layouts = {
				1: 'single',
				2: 'halves',
				3: 'split',
			};

			const updateDisplay = () =>
				sections.forEach((s, i) => (s.textContent = states[i]));

			const getLayout = () =>
				container.classList.contains('halves')
					? 'halves'
					: container.classList.contains('split')
					? 'split'
					: 'single';

			function setLayout(layout) {
				const current = getLayout();
				const vertical = container.classList.contains('vertical');

				if (
					layout === 'single' &&
					current !== 'single' &&
					focusedIndex !== 0
				) {
					[states[0], states[focusedIndex]] = [
						states[focusedIndex],
						states[0],
					];
					focusedIndex = 0;
				} else if (layout !== 'single' && current === 'single') {
					focusedIndex = 0;
				}

				container.className =
					layout +
					(vertical && layout !== 'single' ? ' vertical' : '');
				updateDisplay();
			}

			const toggleOrientation = () => {
				if (getLayout() !== 'single')
					container.classList.toggle('vertical');
			};

			const cycleFocus = () => {
				const count =
					getLayout() === 'halves'
						? 2
						: getLayout() === 'split'
						? 3
						: 1;
				if (count > 1) focusedIndex = (focusedIndex + 1) % count;
			};

			const cycleContent = () => {
				const layout = getLayout();
				if (layout === 'halves') {
					[states[0], states[1]] = [states[1], states[0]];
					focusedIndex ^= 1;
				} else if (layout === 'split') {
					states.unshift(states.pop());
					focusedIndex = (focusedIndex + 1) % 3;
				}
				updateDisplay();
			};

			document.addEventListener('keydown', (e) => {
				if (layouts[e.key]) setLayout(layouts[e.key]);
				else if (e.key === '4') toggleOrientation();
				else if (e.key === 'Tab') e.preventDefault(), cycleFocus();
				else if (e.key === '5') cycleContent();
			});

			updateDisplay();
		</script>
	</body>
</html>
