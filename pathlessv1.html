<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{{.Title}}</title>
		<style>
			:root {
				--border: medium solid blue;
			}
			*,
			*::before,
			*::after {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
				scrollbar-width: none;
				-ms-overflow-style: none;
				user-select: none;
			}
			*::-webkit-scrollbar {
				display: none;
			}
			a,
			a:hover,
			a:visited,
			a:active,
			a:focus {
				text-align: center;
				color: inherit;
				text-decoration: underline;
			}
			html,
			body {
				height: 100vh;
				overflow: hidden;
				scroll-behavior: smooth;
			}

			body {
				font-family: 'Roboto', sans-serif;
				background: black;
				border: var(--border);
				border-radius: 0.3125em;
				color: white;
			}

			#container {
				height: 100vh;
				display: grid;
			}

			.section {
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 2rem;
				contain: layout paint;
			}

			/* Grid layouts */
			.layout-single {
				grid-template: 1fr / 1fr;
			}
			.layout-halves {
				grid-template: 1fr / 1fr 1fr;
			}
			.layout-halves.vertical {
				grid-template: 1fr 1fr / 1fr;
			}
			.layout-split {
				grid-template: 1fr 1fr / 1fr 1fr;
			}

			/* Hidden sections */
			.layout-single #s2,
			.layout-single #s3,
			.layout-halves #s3 {
				display: none;
			}

			/* Borders */
			.layout-halves #s1,
			.layout-split #s1 {
				border-right: var(--border);
			}

			.layout-halves.vertical #s1,
			.layout-split #s2,
			.layout-split.vertical #s1 {
				border-bottom: var(--border);
			}

			/* Grid positions */
			.layout-split #s1 {
				grid-row: 1 / 3;
			}

			.layout-split.vertical #s1 {
				grid-row: 1;
				grid-column: 1 / 3;
			}

			/* Vertical overrides */
			.layout-halves.vertical #s1,
			.layout-split.vertical #s1 {
				border-right: none;
			}

			.layout-split.vertical #s2 {
				border-bottom: none;
				border-right: var(--border);
			}
		</style>
	</head>
	<body>
		<div id="container" class="layout-single">
			<div id="s1" class="section"></div>
			<div id="s2" class="section"></div>
			<div id="s3" class="section"></div>
		</div>

		<script>
			const container = document.getElementById('container');
			const sections = Array.from(container.children);
			let states = ['State 1', 'State 2', 'State 3'];
			let focusedIndex = 0;

			const layouts = {
				1: 'layout-single',
				2: 'layout-halves',
				3: 'layout-split',
			};

			const updateDisplay = () =>
				sections.forEach((s, i) => (s.textContent = states[i]));

			const getLayout = () => {
				if (container.classList.contains('layout-halves'))
					return 'layout-halves';
				if (container.classList.contains('layout-split'))
					return 'layout-split';
				return 'layout-single';
			};

			function setLayout(layout) {
				const current = getLayout();
				const vertical = container.classList.contains('vertical');

				if (
					layout === 'layout-single' &&
					current !== 'layout-single' &&
					focusedIndex !== 0
				) {
					[states[0], states[focusedIndex]] = [
						states[focusedIndex],
						states[0],
					];
					focusedIndex = 0;
				} else if (
					layout !== 'layout-single' &&
					current === 'layout-single'
				) {
					focusedIndex = 0;
				}

				container.className =
					layout +
					(vertical && layout !== 'layout-single' ? ' vertical' : '');
				updateDisplay();
			}

			const toggleOrientation = () => {
				if (getLayout() !== 'layout-single')
					container.classList.toggle('vertical');
			};

			const cycleFocus = () => {
				const layout = getLayout();
				const count =
					layout === 'layout-halves'
						? 2
						: layout === 'layout-split'
						? 3
						: 1;
				if (count > 1) focusedIndex = (focusedIndex + 1) % count;
			};

			const cycleContent = () => {
				const layout = getLayout();
				if (layout === 'layout-halves') {
					[states[0], states[1]] = [states[1], states[0]];
					focusedIndex ^= 1;
				} else if (layout === 'layout-split') {
					states.unshift(states.pop());
					focusedIndex = (focusedIndex + 1) % 3;
				}
				updateDisplay();
			};

			document.addEventListener('keydown', (e) => {
				if (layouts[e.key]) setLayout(layouts[e.key]);
				else if (e.key === '4') toggleOrientation();
				else if (e.key === 'Tab') e.preventDefault(), cycleFocus();
				else if (e.key === '5') cycleContent();
			});

			updateDisplay();
		</script>
	</body>
</html>
